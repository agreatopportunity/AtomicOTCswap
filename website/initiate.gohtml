<!DOCTYPE html>
<html lang="en">
{{template "head"}}
<body>
{{template "menu"}}


<div class="container" id="audit-form">
    <form @submit.prevent="processForm">

        <div class="form-row">
            <div class="form-group col-md-4">
                <label for="coin">Asset</label>
                <select name="coin" id="coin" class="form-control" v-model="form.coin" required>
                    <option disabled selected value> -- select an option -- </option>
                    <option value="btc">Bitcoin</option>
                    <option value="via">Viacoin</option>
                    <option value="ltc">Litecoin</option>
                </select>
            </div>
        </div>
        <div class="form-row">
            <div class="form-group col-md-6">
                <label for="contractHex">Your WIF</label>
                <input type="text" class="form-control" id="wif" name="wif" placeholder="" autocomplete="off" v-model="form.wif" required>
            </div>
        </div>

        <div class="form-row">

            <div class="form-group">
                <label for="amount">Amount</label>
                <input type="number" class="form-control" id="contractTransaction" name="amount" placeholder="" autocomplete="off" step="0.00000001" v-model="form.amount" required>
            </div>

            <div class="form-group col-md-6">
                <label for="contractHex">Counter Party Address</label>
                <input type="text" class="form-control" id="counterPartyAddr" name="counterPartyAddr" placeholder="" autocomplete="off" v-model="form.counterPartyAddr" required>
            </div>
        </div>
        <button type="submit" class="btn btn-primary">Initiate contract</button>

        <div id="response" style="margin-top: 30px">
    <pre v-if="success == true">

        </pre>
            <code v-if="success == true">debug output</code>
            <pre v-if="success == true">${result}</pre>
            <pre v-if="error.length > 0" style="color: red">${error}</pre>
        </div>


    </form>
</div>


<script>
    const app = new Vue({
        delimiters: ['${', '}'],
        el: '#audit-form',
        data() {
            return {
                form: {
                    coin: "",
                    contractHex: "",
                    contractTransaction: ""
                },
                success: false,
                result: [],
                error: [],
            };
        },
        methods: {
            processForm: function () {
                axios({
                    method: 'POST',
                    url: 'http://127.0.0.1:8000/api/initiate',
                    data: new URLSearchParams(this.form).toString(),  // {
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    }
                }).then((response) => {
                    if (response.data.success == true) {
                        this.success = true
                        this.result = response.data.result
                    }else{
                        this.error = response.data.error
                    }
                }).catch((e) => {
                    console.log(e)
                })
                this.clear()
            },
            clear: function () {
                this.result = []
                this.error = []
            }
        }
    });
</script>

</body>
</html>